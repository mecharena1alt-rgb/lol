--// Services
local rep = game:GetService("ReplicatedStorage")
local run = game:GetService("RunService")
local workspace = game:GetService("Workspace")
local players = game:GetService("Players")

--// Config
local remote_name = "RenderKnifeProjectile"
local folder_name = "KnifeProjectiles"

--// State
local enabled = false
local disabledConnections = {}
local cleanupConnection = nil
local childAddedConnection = nil

--// Functions
local function disableRemote()
    local remote = rep:WaitForChild("Remotes"):FindFirstChild(remote_name)
    if not remote then return end

    for _, conn in pairs(getconnections(remote.OnClientEvent)) do
        if conn.Enabled then
            conn:Disable()
            table.insert(disabledConnections, conn)
        end
    end
end

local function enableRemote()
    for _, conn in pairs(disabledConnections) do
        pcall(function()
            conn:Enable()
        end)
    end
    table.clear(disabledConnections)
end

local function startCleanup()
    local folder = workspace:FindFirstChild(folder_name)
    if not folder then return end

    cleanupConnection = run.RenderStepped:Connect(function()
        if enabled and #folder:GetChildren() > 0 then
            folder:ClearAllChildren()
        end
    end)

    childAddedConnection = folder.ChildAdded:Connect(function(child)
        if enabled then
            task.wait()
            child:Destroy()
        end
    end)
end

local function stopCleanup()
    if cleanupConnection then cleanupConnection:Disconnect() end
    if childAddedConnection then childAddedConnection:Disconnect() end
end

local function toggle(state)
    enabled = state
    if enabled then
        disableRemote()
        startCleanup()
        warn("[ANTI-KNIFE] ENABLED")
    else
        enableRemote()
        stopCleanup()
        warn("[ANTI-KNIFE] DISABLED")
    end
end

--// GUI
local player = players.LocalPlayer
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "KnifeBlockerGUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromOffset(180, 80)
frame.Position = UDim2.fromScale(0.4, 0.4)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "Knife Blocker"
title.TextColor3 = Color3.new(1,1,1)
title.Font = Enum.Font.GothamBold
title.TextSize = 14

local button = Instance.new("TextButton", frame)
button.Size = UDim2.fromOffset(140, 30)
button.Position = UDim2.fromOffset(20, 40)
button.Text = "OFF"
button.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
button.TextColor3 = Color3.new(1,1,1)
button.Font = Enum.Font.GothamBold
button.TextSize = 14

local btnCorner = Instance.new("UICorner", button)
btnCorner.CornerRadius = UDim.new(0, 8)

--// Button Logic
button.MouseButton1Click:Connect(function()
    toggle(not enabled)
    if enabled then
        button.Text = "ON"
        button.BackgroundColor3 = Color3.fromRGB(60, 180, 75)
    else
        button.Text = "OFF"
        button.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    end
end)

print("Knife Blocker GUI loaded")
